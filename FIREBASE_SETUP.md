# Firebaseé€£æºã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

## 1. Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

### 1.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
1. [Firebase Console](https://console.firebase.google.com/) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ï¼ˆä¾‹: `o-range-website`ï¼‰
4. Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã¯ä»»æ„ã§è¨­å®š
5. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ

### 1.2 Webã‚¢ãƒ—ãƒªã®è¿½åŠ 
1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ¦‚è¦ãƒšãƒ¼ã‚¸ã§ã€Œã‚¦ã‚§ãƒ–ã€ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆ</>ï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ã‚¢ãƒ—ãƒªã®ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ å…¥åŠ›ï¼ˆä¾‹: `O-range Website`ï¼‰
3. Firebase Hostingã®è¨­å®šã¯ã‚¹ã‚­ãƒƒãƒ—å¯èƒ½
4. ã€Œã‚¢ãƒ—ãƒªã‚’ç™»éŒ²ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
5. **è¨­å®šæƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãŠã**ï¼ˆå¾Œã§ä½¿ç”¨ï¼‰

## 2. Firestoreã®è¨­å®š

### 2.1 Firestore Databaseä½œæˆ
1. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒFirestore Databaseã€ã‚’é¸æŠ
2. ã€Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é¸æŠ**: `asia-northeast1` (æ±äº¬) ã‚’æ¨å¥¨
4. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’é¸æŠ**:
   - é–‹ç™ºä¸­: ã€Œãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã§é–‹å§‹ã€
   - æœ¬ç•ª: ã€Œæœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ã§é–‹å§‹ã€ï¼ˆå¾Œã§ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šï¼‰

### 2.2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã®è¨­å®šï¼ˆæ¨å¥¨ï¼‰

é–‹ç™ºæ™‚ã¯ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã§OK:
```
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // å…¨ã¦èª­ã¿å–ã‚Šå¯èƒ½ï¼ˆå…¬é–‹æƒ…å ±ï¼‰
    match /{document=**} {
      allow read: if true;
      allow write: if false; // æœ¬ç•ªã§ã¯é©åˆ‡ãªèªè¨¼ã‚’å®Ÿè£…
    }
  }
}
```

æœ¬ç•ªç”¨ï¼ˆåŸºæœ¬çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰:
```
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ãƒ¡ãƒ³ãƒãƒ¼æƒ…å ±ã¯èª°ã§ã‚‚èª­ã‚ã‚‹
    match /members/{memberId} {
      allow read: if true;
      allow write: if request.auth != null; // èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
    }
    
    // çµŒéå ±å‘Šã¯èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿
    match /reports/{reportId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
  }
}
```

## 3. Firebase Storageã®è¨­å®š

### 3.1 Storageä½œæˆ
1. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒStorageã€ã‚’é¸æŠ
2. ã€Œå§‹ã‚ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§OK
4. ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ `asia-northeast1` ã‚’é¸æŠ

### 3.2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ï¼ˆæ¨å¥¨ï¼‰

é–‹ç™ºæ™‚:
```
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read: if true;
      allow write: if false; // ç®¡ç†ç”»é¢ã‹ã‚‰ã®ã¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    }
  }
}
```

æœ¬ç•ªç”¨:
```
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // ãƒ¡ãƒ³ãƒãƒ¼ç”»åƒ
    match /members/{memberId}/{imageFile} {
      allow read: if true;
      allow write: if request.auth != null
                   && request.resource.size < 5 * 1024 * 1024 // 5MBä»¥ä¸‹
                   && request.resource.contentType.matches('image/.*');
    }
  }
}
```

## 4. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

### 4.1 `.env.local`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«`.env.local`ã‚’ä½œæˆã—ã€Firebase Consoleã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸè¨­å®šã‚’è²¼ã‚Šä»˜ã‘:

```bash
NEXT_PUBLIC_FIREBASE_API_KEY=AIza...
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your-project.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=your-project-id
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=your-project.appspot.com
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=123456789
NEXT_PUBLIC_FIREBASE_APP_ID=1:123456789:web:abc123
```

**é‡è¦**: `.env.local`ã¯`.gitignore`ã«å«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€Gitã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¾ã›ã‚“ã€‚

## 5. åˆæœŸãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥

### 5.1 é–‹ç™ºç”¨ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install -D ts-node @types/node
```

### 5.2 åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ
```bash
npx ts-node scripts/init-firebase.ts
```

æˆåŠŸã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™:
```
ğŸ”¥ FirestoreåˆæœŸåŒ–ã‚’é–‹å§‹ã—ã¾ã™...
ğŸ“ ãƒ¡ãƒ³ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ä¸­...
  âœ“ æ²³æ‘èˆªå¸Œ
  âœ“ å€‰æ°¸å°†å®
  âœ“ æº–å‚™ä¸­
  âœ“ æº–å‚™ä¸­
ğŸ“ çµŒéå ±å‘Šãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ä¸­...
  âœ“ ã“ã†
  âœ“ ãƒã‚µ
âœ… åˆæœŸãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥ãŒå®Œäº†ã—ã¾ã—ãŸï¼
```

## 6. å‹•ä½œç¢ºèª

### 6.1 é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
```bash
npm run dev
```

### 6.2 ç¢ºèªé …ç›®
- [ ] ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ¡ãƒ³ãƒãƒ¼è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ãŒä½¿ãˆã‚‹
- [ ] ç·¨é›†å†…å®¹ãŒä¿å­˜ã•ã‚Œã‚‹ï¼ˆFirestoreã‚’ç¢ºèªï¼‰
- [ ] çµŒéå ±å‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå‹•ä½œã™ã‚‹ï¼ˆç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ï¼‰

### 6.3 Firestore Consoleã§ç¢ºèª
1. Firebase Console â†’ Firestore Database
2. `members`ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¨`reports`ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
3. å„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ãƒ‡ãƒ¼ã‚¿ãŒå…¥ã£ã¦ã„ã‚‹

## 7. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: "Firebase is not configured"
â†’ `.env.local`ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
â†’ é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•

### ã‚¨ãƒ©ãƒ¼: "Permission denied"
â†’ Firestoreã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèª
â†’ é–‹ç™ºæ™‚ã¯ã€Œãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã€ã§èµ·å‹•

### ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ããªã„
â†’ Firebase StorageãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
â†’ Storageã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèª

### ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œãªã„
â†’ ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª
â†’ Firestoreã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèª

## 8. Firebase Hostingã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆä»»æ„ï¼‰

### 8.1 Firebase CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install -g firebase-tools
```

### 8.2 ãƒ­ã‚°ã‚¤ãƒ³ã¨åˆæœŸåŒ–
```bash
firebase login
firebase init hosting
```

### 8.3 ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
npm run build
firebase deploy --only hosting
```

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

âœ… Firebaseé€£æºå®Œäº†ï¼

ã“ã‚Œã§ä»¥ä¸‹ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸ:
- ãƒ‡ãƒ¼ã‚¿ãŒFirestoreã«ä¿å­˜ã•ã‚Œã‚‹
- è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã§ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰
- ç”»åƒã‚’Firebase Storageã«ä¿å­˜
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ‡ãƒ¼ã‚¿ã‚’åŒæœŸ

ã•ã‚‰ã«æ”¹å–„ã—ãŸã„å ´åˆ:
- Firebase Authenticationã§æœ¬æ ¼çš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼
- Cloud Functionsã§ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å‡¦ç†
- Firebase Hostingã§æœ¬ç•ªå…¬é–‹
